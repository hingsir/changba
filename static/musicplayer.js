// https://github.com/hingsir/web-musicplayer
(function(c,a,d){function e(f){this.container=f.container;this.songList=f.songList||[];this.autoplay=f.autoplay||false;this.init()}e.prototype={init:function(){var f=this;f.render()},render:function(){var f=this;if(f.songList.length>0){return f.renderMusicPlayer(f.songList)}},renderMusicPlayer:function(g){var f=this;f.container.innerHTML='<div id="J_music_player_control">'+'<a id="J_music_player_btn_prev" href="javascript:;">上一首</a>'+'<a id="J_music_player_btn_play" href="javascript:;">播放</a>'+'<a id="J_music_player_btn_next" href="javascript:;">下一首</a>'+"</div>";f.bindEvents();f.songNum=g.length;f.songList=g;f.currIndex=0;f.playByIndex(0)},bindEvents:function(){var f=this;b.bind(f.container,"click",function(h){var g=b.getTarget(h);if(g.id=="J_music_player_btn_prev"){f.prev()}else{if(g.id=="J_music_player_btn_next"){f.next()}else{if(g.id=="J_music_player_btn_play"){if(/played/.test(g.className)){f.pause();f.switchPlayBtn("pause")}else{f.autoplay=true;f.play();f.switchPlayBtn("play")}}}}})},prev:function(){var f=this;f.autoplay=true;if(f.currIndex==0){f.playByIndex(f.songNum-1)}else{f.playByIndex(f.currIndex-1)}f.switchPlayBtn("play")},next:function(){var f=this;f.autoplay=true;if(f.currIndex==f.songNum-1){f.playByIndex(0)}else{f.playByIndex(f.currIndex+1)}f.switchPlayBtn("play")},playByIndex:function(f){var g=this;var h=a.getElementById("J_music_player"),i;if(h){a.body.removeChild(h)}h=a.createElement("audio");h.id="J_music_player";h.autoplay=g.autoplay;h.style.display="none";b.bind(h,"ended",function(){g.next()});i=a.createElement("source");i.id="J_music_player_source";i.src=g.songList[f];h.appendChild(i);a.body.appendChild(h);g.currIndex=f;g.player=h},pause:function(){var f=this;f.player.pause()},play:function(){var f=this;f.player.play()},switchPlayBtn:function(f){var g=a.getElementById("J_music_player_btn_play");g.className=g.className.replace("played","");if(f=="play"){g.className+="played";g.innerHTML="暂停"}else{g.innerHTML="播放"}}};var b={bind:function(h,g,f){if(h.addEventListener){h.addEventListener(g,f,false)}else{if(h.attachEvent){h.attachEvent("on"+g,f)}else{h["on"+g]=f}}},unBind:function(h,g,f){if(h.removeEventListener){h.removeEventListener(g,f,false)}else{if(h.attachEvent){h.detachEvent("on"+g,f)}else{h["on"+g]=null}}},getTarget:function(f){f=f||c.event;return f.target||f.srcElement}};c.MusicPlayer=e})(window,document);
